<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä¸€å¹´çº§æ•°å­¦ Â· ä¸–ç•Œä¸€ï¼šæ•°çš„ç‹å›½ Â· ç¬¬1å…³ æ•°è‹¹æœ</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      background: radial-gradient(circle at top, #0f172a, #020617 60%);
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px 10px 40px;
    }
    .container {
      width: 100%;
      max-width: 900px;
    }
    a.back {
      display: inline-block;
      margin-bottom: 8px;
      font-size: 13px;
      color: #38bdf8;
      text-decoration: none;
    }
    a.back:hover {
      text-decoration: underline;
    }
    h1 {
      margin: 4px 0 4px;
      font-size: 24px;
    }
    .subtitle {
      font-size: 14px;
      color: #9ca3af;
      margin-bottom: 16px;
    }
    .card {
      background: rgba(15,23,42,0.96);
      border-radius: 18px;
      padding: 20px;
      box-shadow: 0 16px 40px rgba(15,23,42,0.9);
      border: 1px solid #1f2937;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 10px;
      font-size: 14px;
      color: #9ca3af;
    }
    .stars {
      letter-spacing: 2px;
      color: #fbbf24;
    }
    .best-record {
      font-size: 12px;
      color: #a5b4fc;
    }
    .game-area {
      margin-top: 10px;
    }
    .round-label {
      font-size: 14px;
      color: #9ca3af;
      margin-bottom: 4px;
    }
    .apples-board {
      margin: 8px 0 14px;
      min-height: 80px;
      border-radius: 14px;
      border: 1px solid #1f2937;
      background: linear-gradient(to bottom, #020617, #020617);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      padding: 10px;
      gap: 8px;
      font-size: 34px;
    }
    .hint-text {
      font-size: 15px;
      margin-bottom: 10px;
    }
    .num-grid {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 8px;
    }
    .num-btn {
      border: 1px solid #1f2937;
      border-radius: 999px;
      padding: 8px 0;
      font-size: 16px;
      background: #020617;
      color: #e5e7eb;
      cursor: pointer;
      transition: all .15s ease;
    }
    .num-btn:hover {
      background: #0b1120;
      border-color: #38bdf8;
    }
    .num-btn.correct {
      background: #16a34a;
      border-color: #22c55e;
      color: #e5fdf0;
    }
    .num-btn.wrong {
      background: #7f1d1d;
      border-color: #ef4444;
      color: #fee2e2;
    }
    .feedback {
      min-height: 22px;
      font-size: 14px;
      margin-top: 4px;
    }
    .feedback.ok {
      color: #4ade80;
    }
    .feedback.bad {
      color: #fca5a5;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    .btn {
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 14px;
      border: none;
      cursor: pointer;
      transition: all .15s ease;
    }
    .btn-next {
      background: #2563eb;
      color: white;
    }
    .btn-next:disabled {
      background: #1f2937;
      color: #6b7280;
      cursor: not-allowed;
    }
    .btn-restart {
      background: transparent;
      border: 1px solid #4b5563;
      color: #9ca3af;
    }
    .summary {
      margin-top: 14px;
      padding: 10px;
      border-radius: 12px;
      background: #020617;
      border: 1px solid #374151;
      font-size: 14px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- å¦‚æœä»¥åæœ‰ä¸€å¹´çº§æ•°å­¦æ€»é¡µé¢ï¼Œå¯ä»¥æ”¹æˆæŒ‡å‘é‚£ä¸ªé¡µé¢ -->
    <a href="math.html" class="back">âª è¿”å›æ•°å­¦å­¦ä¹ ä¸­å¿ƒ</a>

    <h1>ä¸€å¹´çº§æ•°å­¦ Â· ä¸–ç•Œä¸€ï¼šæ•°çš„ç‹å›½ Â· ç¬¬1å…³ æ•°è‹¹æœ</h1>
    <div class="subtitle" id="subtitle">
      è§„åˆ™ï¼šä¸€å…±æœ‰ <b id="total-rounds"></b> é¢˜ï¼Œæ¯é¢˜çœ‹çœ‹æœ‰å¤šå°‘ä¸ª ğŸï¼Œé€‰å‡ºæ­£ç¡®çš„æ•°å­—ã€‚åšå®Œä¼šç»™æ˜Ÿæ˜Ÿè¯„ä»·ã€‚
    </div>

    <div class="card">
      <div class="top-bar">
        <div>å½“å‰å›åˆï¼š<span id="round">1</span>/<span id="round-max"></span></div>
        <div>å½“å‰å¾—åˆ†ï¼š<span id="score">0</span> åˆ†</div>
        <div class="best-record" id="best-record"></div>
      </div>

      <div class="game-area">
        <div class="round-label" id="round-label">ç¬¬ 1 é¢˜ï¼šè®¤çœŸæ•°ä¸€æ•°ï¼Œæœ‰å¤šå°‘ä¸ªè‹¹æœï¼Ÿ</div>
        <div class="apples-board" id="apples-board">
          <!-- åŠ¨æ€ç”Ÿæˆè‹¹æœ -->
        </div>
        <div class="hint-text">è¯·ç‚¹å‡»ä¸‹é¢çš„æ•°å­—ï¼Œå‘Šè¯‰æˆ‘æœ‰å‡ ä¸ª ğŸï¼š</div>
        <div class="num-grid" id="num-grid">
          <!-- 1~10 æŒ‰é’® -->
        </div>
        <div class="feedback" id="feedback"></div>

        <div class="controls">
          <button class="btn btn-restart" id="btn-restart">ğŸ” é‡æ–°è¿™ä¸€å…³</button>
          <button class="btn btn-next" id="btn-next" disabled>ä¸‹ä¸€é¢˜ â–¶</button>
        </div>

        <div class="summary" id="summary"></div>
      </div>
    </div>
  </div>

  <script>
    // ä¸€äº›åŸºç¡€å‚æ•°ï¼šé¢˜ç›®æ•°é‡ã€æ•°å­—èŒƒå›´
    const ROUNDS_MAX = 8; // ä¸€å…³ 8 é¢˜ï¼Œæ—¶é•¿å¤§æ¦‚ 5 åˆ†é’Ÿ
    const MIN_NUM = 1;
    const MAX_NUM = 10;

    const roundEl = document.getElementById("round");
    const roundMaxEl = document.getElementById("round-max");
    const totalRoundsEl = document.getElementById("total-rounds");
    const scoreEl = document.getElementById("score");
    const applesBoardEl = document.getElementById("apples-board");
    const numGridEl = document.getElementById("num-grid");
    const feedbackEl = document.getElementById("feedback");
    const btnNext = document.getElementById("btn-next");
    const btnRestart = document.getElementById("btn-restart");
    const summaryEl = document.getElementById("summary");
    const bestRecordEl = document.getElementById("best-record");
    const roundLabelEl = document.getElementById("round-label");

    let currentRound = 1;
    let currentNumber = 0;
    let score = 0;
    let answered = false;
    let correctCount = 0;

    const STORAGE_KEY = "g1_world1_level1_best";

    function setupNumberButtons() {
      for (let i = MIN_NUM; i <= MAX_NUM; i++) {
        const btn = document.createElement("button");
        btn.className = "num-btn";
        btn.textContent = i;
        btn.dataset.value = i;
        btn.addEventListener("click", () => handleAnswer(i, btn));
        numGridEl.appendChild(btn);
      }
    }

    function resetButtonsState() {
      const buttons = numGridEl.querySelectorAll(".num-btn");
      buttons.forEach(btn => {
        btn.disabled = false;
        btn.classList.remove("correct", "wrong");
      });
    }

    function renderApples(n) {
      applesBoardEl.innerHTML = "";
      for (let i = 0; i < n; i++) {
        const span = document.createElement("span");
        span.textContent = "ğŸ";
        applesBoardEl.appendChild(span);
      }
    }

    function newRound() {
      answered = false;
      feedbackEl.textContent = "";
      feedbackEl.className = "feedback";
      resetButtonsState();
      btnNext.disabled = true;
      summaryEl.style.display = "none";
      summaryEl.textContent = "";

      currentNumber = Math.floor(Math.random() * (MAX_NUM - MIN_NUM + 1)) + MIN_NUM;
      renderApples(currentNumber);
      roundEl.textContent = currentRound;
      roundMaxEl.textContent = ROUNDS_MAX;
      totalRoundsEl.textContent = ROUNDS_MAX;
      roundLabelEl.textContent = `ç¬¬ ${currentRound} é¢˜ï¼šè®¤çœŸæ•°ä¸€æ•°ï¼Œæœ‰å¤šå°‘ä¸ªè‹¹æœï¼Ÿ`;
    }

    function handleAnswer(val, btn) {
      if (answered) return;
      answered = true;

      const buttons = numGridEl.querySelectorAll(".num-btn");
      buttons.forEach(b => b.disabled = true);

      if (val === currentNumber) {
        btn.classList.add("correct");
        feedbackEl.textContent = "âœ… å¤ªæ£’äº†ï¼Œæ•°å¾—å¾ˆè®¤çœŸï¼";
        feedbackEl.classList.add("ok");
        score += 10;
        correctCount += 1;
      } else {
        btn.classList.add("wrong");
        feedbackEl.textContent = `âŒ å†çœ‹çœ‹ï¼Œè¿˜æœ‰æœºä¼šå“¦ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${currentNumber}ã€‚`;
        feedbackEl.classList.add("bad");
      }
      scoreEl.textContent = score;
      btnNext.disabled = false;
    }

    function calcStars() {
      const fullScore = ROUNDS_MAX * 10;
      const ratio = score / fullScore;
      let stars = 1;
      if (ratio >= 0.9) stars = 3;
      else if (ratio >= 0.7) stars = 2;

      return stars;
    }

    function updateBestRecord(stars) {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        let bestStars = 0;
        if (raw) {
          bestStars = JSON.parse(raw).stars || 0;
        }
        if (stars > bestStars) {
          localStorage.setItem(STORAGE_KEY, JSON.stringify({
            stars,
            score,
            time: new Date().toISOString()
          }));
          bestStars = stars;
        }
        if (bestStars > 0) {
          bestRecordEl.textContent = `å†å²æœ€é«˜ï¼š${"â˜…".repeat(bestStars)}${"â˜†".repeat(3 - bestStars)}`;
        } else {
          bestRecordEl.textContent = "";
        }
      } catch (e) {
        // å¿½ç•¥æœ¬åœ°å­˜å‚¨å¼‚å¸¸
      }
    }

    function showSummary() {
      const stars = calcStars();
      const fullScore = ROUNDS_MAX * 10;

      let comment = "";
      if (stars === 3) {
        comment = "å¤ªæ£’äº†ï¼ä½ å·²ç»æ˜¯â€œæ•°è‹¹æœå°é«˜æ‰‹â€å•¦ï¼Œå¯ä»¥æŒ‘æˆ˜ä¸‹ä¸€å…³å•¦ã€‚";
      } else if (stars === 2) {
        comment = "å¾ˆå¥½ï¼å†å¤šç©å‡ æ¬¡ï¼Œä½ ä¸€å®šå¯ä»¥æ‹¿åˆ° 3 é¢—æ˜Ÿã€‚";
      } else {
        comment = "å…ˆåˆ«ç€æ€¥ï¼Œæ…¢æ…¢æ•°ï¼Œå¤šç»ƒå‡ æ¬¡å°±ä¼šæ›´å‰å®³ã€‚";
      }

      summaryEl.style.display = "block";
      summaryEl.innerHTML = `
        <div>æœ¬å…³å®Œæˆ âœ…</div>
        <div style="margin-top:4px;">æ€»å¾—åˆ†ï¼š<b>${score}</b> åˆ† / ${fullScore} åˆ†</div>
        <div style="margin-top:4px;">ç­”å¯¹é¢˜æ•°ï¼š<b>${correctCount}</b> / ${ROUNDS_MAX}</div>
        <div style="margin-top:4px;">æ˜Ÿçº§ï¼š<span class="stars">${"â˜…".repeat(stars)}${"â˜†".repeat(3 - stars)}</span></div>
        <div style="margin-top:6px;">${comment}</div>
      `;
      updateBestRecord(stars);
    }

    btnNext.addEventListener("click", () => {
      if (currentRound < ROUNDS_MAX) {
        currentRound++;
        newRound();
      } else {
        // æœ€åä¸€é¢˜ä¹‹åï¼Œå†ç‚¹ä¸‹ä¸€é¢˜å°±æ˜¾ç¤ºæ€»ç»“
        btnNext.disabled = true;
        showSummary();
      }
    });

    btnRestart.addEventListener("click", () => {
      currentRound = 1;
      score = 0;
      correctCount = 0;
      scoreEl.textContent = score;
      newRound();
    });

    // é¡µé¢åˆå§‹åŒ–ï¼šåŠ è½½å†å²æœ€é«˜è®°å½• + å»ºç«‹æŒ‰é’® + ç¬¬ä¸€é¢˜
    (function init() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          const r = JSON.parse(raw);
          if (r.stars) {
            bestRecordEl.textContent = `å†å²æœ€é«˜ï¼š${"â˜…".repeat(r.stars)}${"â˜†".repeat(3 - r.stars)}`;
          }
        }
      } catch (e) {}
      setupNumberButtons();
      newRound();
    })();
  </script>
</body>
</html>
